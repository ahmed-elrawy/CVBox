<!-- <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }" [template]="customLoadingTemplate">
</ngx-loading> -->
<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }">
</ngx-loading>

<div class="alert-wrapper">
    <alert *ngFor="let alert of alerts" [type]="alert.type" dismissOnTimeout="5000" class="text-center">
        {{ alert.text }}
    </alert>
</div>

<router-outlet></router-outlet>


<mat-accordion class="example-headers-align" *ngIf="currentUser">
    <div>
        <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle>
            <mat-expansion-panel-header class="mat-expansion-panel-header">
                <mat-panel-title color="primary">
                    chat
                </mat-panel-title>

                <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
                </div>
            </mat-expansion-panel-header>




            <div class="inbox_chat">
                <div class="msg_history">
                    <ng-container *ngFor="let chat of chat.chatHead | async">

                        <div class="chat_list active_chat" (click)="getMessages(chat.chat_head_id)">
                            <div class=" chat_people">
                                <div class="chat_img"> <img src="" alt="sunil">
                                </div>
                                <div class="chat_ib">
                                    <h5>Sunil Rajput <span class="chat_date">Dec 25</span></h5>
                                    <p>{{chat.last_message}}</p>
                                </div>
                            </div>
                        </div>

                    </ng-container>
                </div>


            </div>

            <mat-action-row>
                <button mat-button color="primary" (click)="nextStep()">Next</button>
            </mat-action-row>
        </mat-expansion-panel>

    </div>
</mat-accordion>

<!-- messages -->




<mat-accordion *ngIf="chatView" class="example-headers-align message">

    <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle>
        <mat-expansion-panel-header>
            <mat-panel-title>
                Self aware panel
            </mat-panel-title>

            <div class="chat_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil">
            </div>
        </mat-expansion-panel-header>



        <div class="msg_history pb-5" #scrollMe [scrollTop]="scrollMe.scrollHeight">
            <div class="messages" *ngIf="chat.allMessages | async as messages" [@listStagger]="messages.length">
                <mat-card class="message" *ngFor="let message of messages; trackBy: trackById; index as i;"
                    [class.from-me]="message.sender_id=== userId"
                    [class.compact]="messages[i - 1]?.reciver_id ===message.reciver_id "
                    [class.compact]="messages[i - 1]?.sender_id ===message.sender_id">

                    <mat-card-header>
                        <img mat-card-avatar
                            src="https://firebasestorage.googleapis.com/v0/b/firestore-75cc6.appspot.com/o/%20profile%2FfwidhA8MlWbIKuQlbMrCusd7LYb2%2F%20profile-Image.jpg%20?alt=media&token=46b7b21e-3932-47b7-acc9-4cfca0639d5f">
                        <mat-card-title>Ahmed</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <div class="body">{{ message.message }}</div>
                        <div class="time">{{ message.created_at.seconds*1000 | date }}</div>
                    </mat-card-content>
                </mat-card>
            </div>
        </div>


        <div style="  position: absolute;   bottom:   0;
        background-color:white; width: 100%; height: 50px; z-index: 50;
                        ">
            <div class="type_msg">
                <div class="input_msg_write">



                    <input [(ngModel)]="newMsg" type="text" class="write_msg" (keydown.enter)="sendMessage()"
                        placeholder="Type a message" />
                    <button (click)="sendMessage()" (keydown.enter)="sendMessage()" class="msg_send_btn" type="button"
                        [disabled]="!newMsg"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
                </div>
            </div>
        </div>

    </mat-expansion-panel>
</mat-accordion>